local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "larp.lol " .. Fluent.Version,
    SubTitle = "by 9ausn",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = false,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "" }),
    Misc = Window:AddTab({ Title = "Misc", Icon = "" })
}

local Options = Fluent.Options

local Toggle = Tabs.Main:AddToggle("CamlockToggle", { Title = "Enable Camlock", Default = false })

local CamlockEnabled = false

Toggle:OnChanged(function()
    CamlockEnabled = Options.CamlockToggle.Value
end)

local function SetupCamlock()
    local Players = game:GetService("Players")
    local Workspace = game:GetService("Workspace")
    local Player = Players.LocalPlayer
    local Character = Player.Character or Player.CharacterAdded:Wait()
    local Camera = Workspace.CurrentCamera
    local Humanoid = Character:WaitForChild("Humanoid")

    -- Ensure PracticeArea is not considered
    if Workspace:FindFirstChild("PracticeArea") then
        Workspace.PracticeArea.Parent = Workspace -- Move it out of "Courts"
    end

    local GetGoal = function()
        local Distance, Goal = math.huge, nil

        for _, court in ipairs(Workspace.Courts:GetChildren()) do
            -- Ensure the court is valid and not the PracticeArea
            if court ~= Workspace:FindFirstChild("PracticeArea") then
                for _, Obj in ipairs(court:GetDescendants()) do
                    if Obj.Name == "Swish" and Obj.Parent:FindFirstChildOfClass("TouchTransmitter") then
                        local Magnitude = (Character.PrimaryPart.Position - Obj.Parent.Position).Magnitude
                        if Magnitude < Distance then
                            Distance = Magnitude
                            Goal = Obj.Parent
                        end
                    end
                end
            end
        end

        return Goal, Distance
    end

    local function CalculateArc(dist)
        if dist <= 60 then
            return 30
        elseif dist <= 65 then
            return 25
        elseif dist <= 70 then
            return 20
        elseif dist <= 75 then
            return 15
        elseif dist <= 80 then
            return 10
        else
            return 5
        end
    end

    local AdjustCameraToGoal = function()
        if not CamlockEnabled then return end
        local Goal, Distance = GetGoal()

        if Goal then
            local HoopPosition = Goal.Position
            local ArcAdjustment = CalculateArc(math.floor(Distance))
            local NewCameraPosition = HoopPosition + Vector3.new(0, ArcAdjustment, 0)
            Camera.CameraType = Enum.CameraType.Scriptable
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, NewCameraPosition)
        end
    end

    local ResetCamera = function()
        Camera.CameraType = Enum.CameraType.Custom
    end

    Humanoid.StateChanged:Connect(function(_, NewState)
        if CamlockEnabled and NewState == Enum.HumanoidStateType.Jumping then
            AdjustCameraToGoal()
        elseif NewState == Enum.HumanoidStateType.Landed then
            ResetCamera()
        end
    end)
end

SetupCamlock()
